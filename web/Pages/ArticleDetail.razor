@page "/articles/{SectionRef}/{ArticleRef}"

@using Services

@inject IArticlesService dataService

<PageTitle Title="@article?.Title" />

@if (section == null || article == null)
{
    <div class="loading">Loading...</div>

    @if(allArticles != null)
    {
        <h4>All Articles in @SectionRef</h4>

        <ul>
        @foreach(var article in allArticles)
        {
            <li>@article.Reference - @article.Title</li>
        }
        </ul>
    }
} else
{
    <h1><span class="sectionIcon oi @section.Glyph" aria-hidden="true"></span>@article.Title
    <span style="float:right"><web.Controls.PdfDownload PdfUrl="@article.PdfUrl" /></span>
    </h1>
    <h5>
        @if (!string.IsNullOrEmpty(section.Reference)) {
        <a href="/articles/@section.Reference"><span class="oi oi-chevron-left"></span>&nbsp;@section.Title</a>
        } else {
            @section.Title
        }

        @if (!string.IsNullOrEmpty(article.Parent?.Reference)) {
        <a href="/articles/@section.Reference/@article.Parent.Reference"><span class="oi oi-chevron-left"></span>&nbsp;@article.Parent.Title</a>
        } 
    </h5>
    @if (article.Children.Any())
    {
        <hr />
        <h5>Related:</h5>
        <web.Controls.RelatedArticlesView Articles=@article.Children Section=@section />
    }
    <hr />
    <div>
        <web.Controls.MarkdownView ContentUrl="@article.ContentUrl"/>
    </div>
}

@code {

    [Parameter]
    public string SectionRef { get; set; }

    [Parameter]
    public string ArticleRef { get; set; }

    private Models.Section section;
    private Models.Article[] allArticles;
    private Models.Article article;

    protected override async Task OnParametersSetAsync()
    {
        section = await dataService.GetSection(SectionRef);
        allArticles = await dataService.GetAllArticlesInTree(SectionRef);
        article = await dataService.GetArticle(SectionRef, ArticleRef);   
    }
}